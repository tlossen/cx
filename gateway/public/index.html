<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>cx</title>
  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
  <script src="https://raw.github.com/leonidas/transparency/master/dist/transparency.min.js"></script>
</head>
<body>

<div id="template">
  <span class="greeting"></span>
  <span data-bind="name"></span>
</div>

<script type="text/javascript" charset="utf-8">
$(function() {
  var source = new EventSource("/downstream?private_channel_auth_token=abc123");
  source.addEventListener("open", function(e) {
    console.log("connected")
  }, false);
  source.addEventListener("error", function(e) {
    if (e.readyState == EventSource.CLOSED) {
      console.log("disconnected");
    }
  }, false);

  source.addEventListener("message", function(e) {
    console.log("new message: ", e.data);
    $("#template").render($.parseJSON(e.data));
  }, false);

  source.addEventListener("userlogon", function(e) {
    console.log("userlogon: ", e.data);
  })
});
</script>
</body>
</html>
